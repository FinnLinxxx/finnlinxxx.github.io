# ROSIA

![ROSIA_TF](/assets/images/ROSIA_TFs.png)

* .pcd ist das entgültige Format in dem alle anfallenden Punktwolken gespeichert werden.

```bash
$ rosrun tf static_transform_publisher 0 0 0 0 0 0 map lasertracker 300
$ rosrun tf static_transform_publisher 0.483625 -6.67595 -0.60245 1.52678234641 0.00815 -0.000725 lasertracker base_link 300
$ rosrun tf static_transform_publisher 2.2008279 21.4569023 0.1236064 -1.6730 -0.0008 -0.0076 lasertracker leica_ms50 300
$ rosrun tf static_transform_publisher 0.0832 -0.1498 0.1482 0 0 0 tool0 tscan_back 300
$ rosrun tf static_transform_publisher 0.0968 -0.0846 0.2281 0 0 0 tool0 tscan_right 300
```

## Definition der Koordinatensysteme der Messmittel

Im aktuellen Aufbau steht die Leica MS50 im Labor auf dem Messpfeiler 9 (MP9). Der dynamixel betriebene Drehtisch steht so, dass die Platte etwa 30 Meter 
das Labor hinunter vom Leica MS50-Laserscanner entfernt steht. Davor steht der Roboterarm-(Tisch) mit dem Roboterarm und gut 7 Meter davon entfernt der Lasertracker,
der so aufgestellt werden muss, dass wenn der Robotearm verfährt die Grenzbereiche der Verdrehung der TScan eingehalten werden, es bleibt daher gegenüber
der oben genannten Position (lasertracker zu base_link) nur wenig Spiel.

Sowohl die Daten der T-Scan als auch der Leica MS50 Laserscanns werden als rechtshändisch betrachtet. Entscheidend für die Koordinatentransformation ist die
Beziehung zwischen der Verdrehung `lasertracker` zum `leica_ms50` frame

Die Daten des Lasertrackers werden als Referenz angesehen, dies gilt im Bezug auf die gemessenen Netzpunkte wie auch für die Daten der T-Scan, daher liegt 
der Lasertracker `lasertracker` im Urpsrung (0,0,0). Die X-Achse die beim Tracker die Achse, bei der eine rote Markierung an der Seite am Tracker angebracht ist. die Y-Achse zeigt ungefähr in Richtung des Tachymeters.

Das Tachymeter ist entsprechend der Ergebnisse aus der Netzmessung gegenüber dem Lasertracker positioniert, Verkippungen in der X- und Y-Achse ergebene sich dadurch, dass der Lasertracker, anders als die Leica MS50, nicht horizontiert wird. Die X-Achse der Leica MS50 ist die Teilkreisnullrichtung (0 Richtung), diese wurde in der Vergangenheit so gelegt, dass sie ungefähr in Richtung der Platte liegt (zuletzt auch direkt auf den Lasertracker zeigend). Die Y-Achse liegt dann in Richtung der "Fensterseite" des Labors.

## Leica MS50 Laserscan zu .pcd 

* Die Daten des Lasertrackers werden als .sdb vom Gerät geladen und anschließend über den rosservice ins .pts Format umgewandelt. ACHTUNG! Das .pts Format steht im Wiederspruch zu der hier zuvor benannten Definition.

` Defitionion .pts ---> Spalte 1: x, Spalte 2: y, Spalte 3: z, Spalte 4: Intensität,...).`

Dies wird im späteren Verlauf der Datenauswertung vom Program `igros_rosia transf_scans2pcd` bei der Umwandlung der Scans ins entgültige Datenformat `.pcd` berücksichtigt! 

` Defitionion .pts zu .pcd ---> Spalte 1: y (aus .pts), Spalte 2: -1*x (aus .pts), Spalte 3: z (aus .pts), Spalte 4: Intensität (aus .pts)).`

Das Ergebnis ist demnach 

` Defitionion .pcd in ROS  ---> Spalte 1: x, Spalte 2: y, Spalte 3: z, Spalte 4: Intensität).`

## Leica T-Scan Daten zu .pcd 

* Die Daten der T-Scan werden bisher über die Pipe im .txt Format gespeichert. Da die Daten bereits lesbar vorliegen ist keine weitere Prozessierung notwendig. ACHTUNG! Das .txt Format (Daten Laserscanner) steht im Wiederspruch zu der hier zuvor benannten Definition.

` Defitionion .txt ---> Spalte 1: x [mm], Spalte 2: y [mm], Spalte 3: z [mm]).` (Musmaßlich nur gültig bei Einhaltung der Messgrößen in Spatial Analyzer).

` Defitionion .txt zu .pcd ---> Spalte 1: y/1000 (aus .txt), Spalte 2: x/1000 (.txt), Spalte 3: z/1000 (.txt)).` 
(Mutmaßlich nur gültig bei Einhaltung der Messgrößen in Spatial Analyzer).

