<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Microfacet ¬∑ Simulation</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="content-wrapper">
    <h1>Photonen-Simulation: Mikrofacetten</h1>
    <p>
      Diese interaktive Simulation demonstriert die Lichtstreuung an rauen Oberfl√§chen. 
      Sie k√∂nnen Parameter wie Rauigkeit, Brechungsindex und Detektorgeometrie in Echtzeit ver√§ndern.
    </p>
  </div>

  <div id="simulation-window">
    <div id="left">
      <div class="mf-box">
        <canvas id="mf-view" class="mf-canvas" width="1600" height="1200" aria-label="Simulation View"></canvas>
      </div>

      <div id="uiContainer" class="mf-controls">
        <button id="toggleUiBtn" title="Toggle Menu">‚ñ∂</button>

        <div class="mf-scroll-area">
          
          <div class="group-box">
            <div class="group-title">simulation & source</div>
            <div class="mf-row">
              <label for="mf-speed">Speed</label>
              <input id="mf-speed" type="range" min="10" max="2000" step="1" value="500" />
              <div id="mf-speedVal" class="mf-val">500 px/s</div>
            </div>
            <div class="mf-row">
              <label for="mf-count">Photons</label>
              <input id="mf-count" type="range" min="1" max="10000" step="1" value="400" />
              <div id="mf-countVal" class="mf-val">400</div>
            </div>
            <div class="mf-row">
              <label for="mf-autoStop">Auto-Stop</label>
              <div style="display:flex; align-items:center; gap:8px; flex:1;">
                  <input id="mf-autoStop" type="checkbox" style="width:14px; height:14px;" />
                  <input id="mf-stopTime" type="number" step="0.1" min="0.1" value="1.8" style="width:50px; border:1px solid #d0d7de; border-radius:4px; text-align:center; font-size:11px;" />
                  <span style="font-size:11px; color:#6b7c8f;">Sec</span>
              </div>
            </div>
            <div class="mf-row">
              <label for="mf-radius">Point Size</label>
              <input id="mf-radius" type="range" min="0.5" max="20.0" step="0.1" value="5.5" />
              <div id="mf-radiusVal" class="mf-val">5.5 px</div>
            </div>
            <div class="mf-row">
              <label for="mf-sigOrtho">Beam Width œÉ‚ä•</label>
              <input id="mf-sigOrtho" type="range" min="0" max="120" step="1" value="14" />
              <div id="mf-sigOrthoVal" class="mf-val">14 px</div>
            </div>
            <div class="mf-row">
              <label for="mf-sigPara">Length œÉ‚à•</label>
              <input id="mf-sigPara" type="range" min="0" max="120" step="1" value="0" />
              <div id="mf-sigParaVal" class="mf-val">0 px</div>
            </div>
          </div>

          <div class="group-box">
            <div class="group-title">material & physics</div>
            <div class="mf-row">
              <label for="mf-n">Refractive Index n</label>
              <input id="mf-n" type="range" min="1.05" max="3.00" step="0.01" value="1.40" />
              <div id="mf-nVal" class="mf-val">1.40</div>
            </div>
            <div class="mf-row">
              <label for="mf-a">Absorption ¬µ‚Çê</label>
              <input id="mf-a" type="range" min="0" max="100" step="0.1" value="50" />
              <div id="mf-aVal" class="mf-val">0.32</div>
            </div>
            <div class="mf-row">
              <label for="mf-s">Scattering ¬µ‚Çõ</label>
              <input id="mf-s" type="range" min="0" max="100" step="0.1" value="65" />
              <div id="mf-sVal" class="mf-val">1.00</div>
            </div>
            <div class="mf-row">
              <label for="mf-hg">Anisotropy g</label>
              <input id="mf-hg" type="range" min="-0.95" max="0.95" step="0.01" value="0" />
              <div id="mf-hgVal" class="mf-val">0</div>
            </div>
            <div class="mf-row">
              <label for="mf-useFresnel">Fresnel Eq.</label>
              <input id="mf-useFresnel" type="checkbox" checked />
              <div id="mf-useFresnelVal" class="mf-val">On</div>
            </div>
          </div>

          <div class="group-box">
            <div class="group-title">surface & geometry</div>
            <div class="mf-row">
              <label for="mf-rough">Roughness</label>
              <input id="mf-rough" type="range" min="0" max="1" step="0.01" value="0.37" />
              <div id="mf-roughVal" class="mf-val">0.37</div>
            </div>
            <div class="mf-row">
              <label for="mf-facetRes">Facet Density</label>
              <input id="mf-facetRes" type="range" min="0" max="1" step="0.01" value="0.07" />
              <div id="mf-facetResVal" class="mf-val">Facets‚âà‚Äî</div>
            </div>
            <div class="mf-row">
              <label for="mf-detWidth">Detector Width</label>
              <input id="mf-detWidth" type="range" min="10" max="800" step="1" value="200" />
              <div id="mf-detWidthVal" class="mf-val">200 px</div>
            </div>
          </div>

          <div class="group-box">
            <div class="group-title">view & filter</div>
            <div class="mf-row">
              <label for="mf-zoom">Zoom</label>
              <input id="mf-zoom" type="range" min="1" max="6" step="0.01" value="1" />
              <div id="mf-zoomVal" class="mf-val">1.00√ó</div>
            </div>
            <div class="mf-row">
              <label for="mf-geoToggle">Overlay (Lines)</label>
              <input id="mf-geoToggle" type="checkbox" checked />
              <div id="mf-geoVal" class="mf-val">On</div>
            </div>
            <div class="mf-row">
              <label for="mf-showDet">Show Detector</label>
              <input id="mf-showDet" type="checkbox" />
              <div id="mf-showDetVal" class="mf-val">Off</div>
            </div>
            <div class="mf-row">
              <label for="mf-showRed">Reflection (red)</label>
              <input id="mf-showRed" type="checkbox" checked />
              <div id="mf-showRedVal" class="mf-val">On</div>
            </div>
            <div class="mf-row">
               <label>SSS (purple)</label>
               <div style="display:flex; align-items:center; gap:12px; flex:1;">
                 <label style="font-weight:normal; cursor:pointer; font-size:11px;">
                   <input id="mf-showSSS" type="checkbox" checked style="vertical-align:middle; margin-right:4px;" />Show
                 </label>
                 <label style="font-weight:normal; cursor:pointer; font-size:11px; color:#dba225;">
                   <input id="mf-hideReentry" type="checkbox" style="vertical-align:middle; margin-right:4px;" />Hide Re-entry
                 </label>
               </div>
            </div>
          </div>

          <div class="group-box full-width">
            <div class="colors-grid">
              <div class="color-item">
                <label>Material</label>
                <div class="rgba-inputs">
                  <input type="number" id="c-mat-r" value="238" min="0" max="255"><input type="number" id="c-mat-g" value="227" min="0" max="255"><input type="number" id="c-mat-b" value="244" min="0" max="255"><input type="number" id="c-mat-a" value="1" step="0.1" min="0" max="1">
                </div>
                <button id="btnSetMat" class="sm-btn">Set</button>
              </div>
              <div class="color-item">
                <label>Air</label>
                <div class="rgba-inputs">
                  <input type="number" id="c-air-r" value="135" min="0" max="255"><input type="number" id="c-air-g" value="206" min="0" max="255"><input type="number" id="c-air-b" value="235" min="0" max="255"><input type="number" id="c-air-a" value="1" step="0.1" min="0" max="1">
                </div>
                <button id="btnSetAir" class="sm-btn">Set</button>
              </div>
              <div class="color-item">
                <label>Overlay</label>
                <div class="rgba-inputs">
                  <input type="number" id="c-fit-r" value="235" min="0" max="255"><input type="number" id="c-fit-g" value="30" min="0" max="255"><input type="number" id="c-fit-b" value="0" min="0" max="255"><input type="number" id="c-fit-a" value="0.7" step="0.1" min="0" max="1">
                </div>
                <button id="btnSetFit" class="sm-btn">Set</button>
              </div>
              <div class="color-item">
                <label>SSS</label>
                <div class="rgba-inputs">
                  <input type="number" id="c-sss-r" value="60" min="0" max="255"><input type="number" id="c-sss-g" value="55" min="0" max="255"><input type="number" id="c-sss-b" value="180" min="0" max="255"><input type="number" id="c-sss-a" value="0.75" step="0.05" min="0" max="1">
                </div>
                <button id="btnSetSSS" class="sm-btn">Set</button>
              </div>
            </div>
          </div>

          <div class="btnRow">
            <button id="btnPlay" class="primary">‚è∏Ô∏é Pause</button>
            <button id="btnSnapshot" style="border-color:#2ecc71; color:#2ecc71; padding:6px 8px;">üì∑ HD</button>
            <button id="btnSvg" style="border-color:#9b59b6; color:#9b59b6; padding:6px 8px;">‚úíÔ∏è SVG</button>
            <button id="btnReset">Reset</button>
            <span style="color:#6b7c8f; font-size:11px; margin-left:4px;">[Space/H]</span>
          </div>

        </div> 
      </div>
    </div>
  </div>

  <div class="content-wrapper">
    <h2>Physikalischer Hintergrund</h2>
    <p>
      Die Simulation basiert auf der geometrischen Optik. Photonen werden als Strahlen verfolgt (Raytracing),
      wobei an jeder Grenzfl√§che die Fresnel-Gleichungen √ºber Reflexion oder Transmission entscheiden.
      Im Inneren des Materials findet Volumenstreuung statt, modelliert durch die Henyey-Greenstein-Phasenfunktion.
    </p>
    <p style="color:#666; font-size:0.9em; margin-top:20px;">
      ¬© 2025 Finn's Physics Lab
    </p>
  </div>

  <script src="engine.js"></script>
  <script src="app.js"></script>
</body>
</html>
